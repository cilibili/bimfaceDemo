#### 1. 文件管理模块

##### 1. HTTP POST /fileUpload

- 接口描述：上传前端携带的文件到服务器，保存文件信息到数据库中，默认路径/binfaceDemo/files（项目路径）
- 接口类型：HTTP POST
- 消息格式：json
- 请求字段：

| 字段名   | 字段类型      | 描述                       |
| -------- | :------------ | -------------------------- |
| file     | MultipartFile | 前端携带的文件             |
| destPath | String        | 文件的路径（不包含文件名） |
| userName | String        | 执行文件操作的用户名       |

- 请求示例：

```
{
	"file": 文件,
    "destPath": "d:/user/local/",
    "userName": "XiaoWang"
}
```

- 成功返回字段：

  - fileMessageId： 文件保存在数据库的id

  - status: Integer：文件保存情况

    0：上传成功，

    -1：文件上传失败，

    -2：文件为空，

    -3：上传地址文件已存在

    -11：没有传入文件

    -12：服务器文件夹不存在

- 成功返回示例：

```json
{
    "code": "0",
    "fileMessageId": "1"
}
```

- 失败返回字段：status


- 失败返回示例
```
{
    "code": "-1"
}
```




##### 2. HTTP GET /fileDownload

- 接口描述：下载文件。需要用户指定下载文件的源路径和下载目的路径和文件名（如果本地存在同名文件，则会重命名下载文件后缀）

  注意：如果没有传入下载路径，默认下载路径设置的是bimfaceDemo/files/，（项目路径根目录）

- 接口类型：HTTP GET

- 消息格式：json

- 请求字段：

| 字段名     | 字段类型 | 描述                                                         |
| ---------- | :------- | ------------------------------------------------------------ |
| sourcePath | String   | 下载文件的源路径（服务器中文件存放的路径，文件夹末尾"/"不能缺） |
| fileName   | String   | 待下载文件名                                                 |
| destPath   | String   | 下载文件的目标路径（文件将要存放的本地路径，文件夹末尾"/"不能缺） |

- 请求示例：

```
{
    "sourcePath": "d:/user/local/",
    "fileName": "2",
    "destPath": "d:/windows/desktop/",
}
```

- 成功返回字段：
  - code: Integer：下载完成情况

    0：下载成功，

    -1：下载失败，

    -2：下载的源文件不存在，

    -12：下载路径(文件夹)不存在
- 成功返回示例：

```json
{
    "code": "0"
}
```

- 失败返回字段：status
- 失败返回示例

```
{
    "code": "-1"
}
```



##### 3. HTTP GET /httpFileDownload

- 接口描述：前端通过页面下载文件，文件输出流返回response，下载到页面（需要前端页面，没有经过测试）
- 接口类型：HTTP GET
- 消息格式：json
- 请求字段：

| 字段名     | 字段类型 | 描述                                                         |
| ---------- | :------- | ------------------------------------------------------------ |
| sourcePath | String   | 下载文件的源路径（服务器中文件存放的路径，文件夹末尾"/"不能缺） |
| fileName   | String   | 待下载文件名                                                 |
| destPath   | String   | 可以不用传此参数。下载文件的目标路径，文件输出流是response   |

- 请求示例：

```
{
    "sourcePath": "d:/user/local/",
    "fileName": "2"
}
```

- 成功返回字段：

  - status: Integer：下载完成情况

    0：下载成功，

    -1：下载失败，

    -2：下载的源文件不存在，

    -12：下载路径不存在

- 成功返回示例：

```json
{
    "code": "0"
}
```

- 失败返回字段：status
- 失败返回示例

```
{
    "code": "-1"
}
```





#### 2. 文件信息管理模块

##### 数据设计

表：

- fileMessage

| 字段名   | 类型   | 描述                 | 约束 |
| -------- | ------ | -------------------- | ---- |
| id       | String | 文件id               | 主键 |
| path     | String | 服务器中文件路径     |      |
| fileName | String | 文件名               |      |
| userName | String | 执行文件上传的用户名 |      |



##### 1. HTTP GET /fileMessage/{id}

- 接口描述：根据文件上传后的id，查询文件信息
- 接口类型：HTTP PUT 
- 消息格式：json
- 请求字段：

| 字段名 | 字段类型 | 描述                   |
| ------ | :------- | ---------------------- |
| id     | String   | 文件在数据库中保存的id |

- 请求示例：

```
/fileMessage/1
```

- 成功返回字段：

  code: 返回结果，0代表返回成功，-10代表该id，不存在

  fileMessage：

  - "id":  文件id
  - "path":  服务器中文件路径
  - "fileName":  文件名
  - "userName":   执行文件上传的用户名

- 成功返回示例：

```json
{
    "code": 0,
    "fileMessage": {
        "id": 4,
        "path": "\\deskTol\\ppp",
        "fileName": "transition.png",
        "userName": "chenbin"
    }
}
```

- 失败返回字段：

```
{
    "code": -1
}
```

- 失败返回示例



##### 2. HTTP GET/fileMessage

- 接口描述：查询保存的所有的fileMessage（文件信息）
- 接口类型：HTTP GET
- 消息格式：json
- 请求字段：None

- 请求示例：

```
/fileMessage
```

- 成功返回字段：

  code: 返回结果，0代表返回成功，-10代表表中没有值

  fileMessage:

  - "id":  文件id
  - "path":  服务器中文件路径
  - "fileName":  文件名
  - "userName":   执行文件上传的用户名

- 成功返回示例：

```json
{
    "code": 0,
    "fileMessage": [
        {
            "id": 1,
            "path": "\\Documents\\WeChat Files\\",
            "fileName": "空调水平面图.dwg",
            "userName": "chenbin"
        },
        {
            "id": 2,
            "path": "\\deskTol\\cccc",
            "fileName": "平面图.dwg",
            "userName": "chenbin"
        },
        {
            "id": 3,
            "path": "\\deskTol\\ppp",
            "fileName": "transition.png",
            "userName": "chenbin"
        }
	]
}
```

- 失败返回字段：

```
{
    "code": -1
}
```

- 失败返回示例：



##### 3. HTTP DELETE /fileMessage/{id}

- 接口描述：删除数据库中id对应的fileMessage，删除对应fileMessage之前会删除该id，对应的文件
- 接口类型：HTTP DELETE 
- 消息格式：json
- 请求字段：

| 字段名 | 字段类型 | 描述                   |
| ------ | :------- | ---------------------- |
| id     | String   | 文件在数据库中保存的id |

- 请求示例：

```
/fileMessage/1
```

- 成功返回字段：

  - code: Integet：删除情况

    0：文件删除成功，

    -1：文件转移失败

    -2：源文件不存在，

    -3：删除源文件失败，

    -10：对应id不存在 ，

    -12 文件夹不存在
- 成功返回示例：

```json
{
    "code": 0
}
```

- 失败返回字段：
- 失败返回示例



##### 4. HTTP PUT /fileMessage

- 接口描述：修改文件信息，文件名，存储路径等信息。修改文件路径和文件名后文件保存路径会转移到修改后的路径下面

- 接口类型：HTTP POST

- 消息格式：json

- 请求头：（不懂欸，啥意思）

- 请求字段：

| 字段名   | 字段类型 | 描述                           |
| -------- | :------- | ------------------------------ |
| openid   | String   | 每个微信用户登录小程序独有的id |
| phoneNum | String   | 用户电话号码                   |

- 请求示例：

```json
{
    "id": 1,
    "path": "D:/xxxxxxz/",
    "fileName": "transition1.png",
    "userName": "chenbin"
}
```

- 成功返回字段：

  - code: Integet：删除情况:

    0：文件删除成功，

    -1：文件转移失败，

    -2：源文件不存在，

    -3：删除源文件失败，

    -10：对应id不存在,

    -11：传入参数为空，

     -12 文件夹不存在,

    -13：未传入参数id或则path

- 成功返回示例：

```json
{
    "code": 0
}
```

- 失败返回字段：
- 失败返回示例



##### 5. 备注：没有HTTP POST /fileMessage新增文件信息接口

在调用POST /fileUpload接口时，接口业务逻辑会保存文件信息。



#### 3 文件信息管理模块

##### 数据设计

表：

- foderMessage

| 字段名      | 类型   | 描述                 | 约束 |
| ----------- | ------ | -------------------- | ---- |
| id          | String | 文件id               | 主键 |
| path        | String | 服务器中文件路径     |      |
| userName    | String | 执行文件上传的用户名 |      |
| create_time | String | 创建时间             |      |



##### 1. HTTP POST /foder/foderMessage

- 接口描述：新增文件夹信息
- 接口类型：HTTP POST
- 消息格式：json
- 请求字段：

| 字段名      | 类型   | 描述                 | 约束 |
| ----------- | ------ | -------------------- | ---- |
| id          | String | 文件id               | 主键 |
| path        | String | 服务器中文件路径     |      |
| userName    | String | 执行文件上传的用户名 |      |
| create_time | String | 创建时间             |      |

- 请求示例：

```
{
    "id": 4,
    "path": "/desktop/ppp",
    "createTime": "2019/7/23",
    "userName": "chenbin"
}
```

- 成功返回字段：

  - code: 返回插入结果，

    0：插入成功

    -1：

    -2：

    ...

- 成功返回示例：

```json
{
    "code": 0,
}
```

- 失败返回字段：

```
{
    "code": -1
}
```

- 失败返回示例



##### 2. HTTP GET /foder/foderMessage/{id}

- 接口描述：根据文件上传后的id，查询文件信息
- 接口类型：HTTP PUT 
- 消息格式：json
- 请求字段：

| 字段名 | 字段类型 | 描述                   |
| ------ | :------- | ---------------------- |
| id     | String   | 文件在数据库中保存的id |

- 请求示例：

```
/fileMessage/1
```

- 成功返回字段：

  code: 返回结果，0代表返回成功，-10代表该id，不存在

  fileMessage：

  - "id":  文件id
  - "path":  服务器中文件路径
  - "fileName":  文件名
  - "userName":   执行文件上传的用户名

- 成功返回示例：

```json
{
    "code": 0,
    "fileMessage": {
        "id": 4,
        "path": "\\deskTol\\ppp",
        "fileName": "transition.png",
        "userName": "chenbin"
    }
}
```

- 失败返回字段：

```
{
    "code": -1
}
```

- 失败返回示例



##### 3. HTTP GET /foder/foderMessage

- 接口描述：查询保存的所有的fileMessage（文件信息）
- 接口类型：HTTP GET
- 消息格式：json
- 请求字段：None
- 请求示例：

```
/fileMessage
```

- 成功返回字段：

  code: 返回结果，0代表返回成功，-10代表表中没有值

  fileMessage:

  - "id":  文件id
  - "path":  服务器中文件路径
  - "fileName":  文件名
  - "userName":   执行文件上传的用户名

- 成功返回示例：

```json
{
    "code": 0,
    "fileMessage": [
        {
            "id": 1,
            "path": "\\Documents\\WeChat Files\\",
            "fileName": "空调水平面图.dwg",
            "userName": "chenbin"
        },
        {
            "id": 2,
            "path": "\\deskTol\\cccc",
            "fileName": "平面图.dwg",
            "userName": "chenbin"
        },
        {
            "id": 3,
            "path": "\\deskTol\\ppp",
            "fileName": "transition.png",
            "userName": "chenbin"
        }
	]
}
```

- 失败返回字段：

```
{
    "code": -1
}
```

- 失败返回示例：



##### 4. HTTP DELETE /foder/foderMessage/{id}

- 接口描述：删除数据库中id对应的fileMessage，删除对应fileMessage之前会删除该id，对应的文件
- 接口类型：HTTP DELETE 
- 消息格式：json
- 请求字段：

| 字段名 | 字段类型 | 描述                   |
| ------ | :------- | ---------------------- |
| id     | String   | 文件在数据库中保存的id |

- 请求示例：

```
/fileMessage/1
```

- 成功返回字段：

  - code: Integet：删除情况

    0：文件删除成功，

    -1：文件转移失败

    -2：源文件不存在，

    -3：删除源文件失败，

    -10：对应id不存在 ，

    -12 文件夹不存在

- 成功返回示例：

```json
{
    "code": 0
}
```

- 失败返回字段：
- 失败返回示例



##### 5. HTTP PUT /foder/foderMessage

- 接口描述：修改文件信息，文件名，存储路径等信息。修改文件路径和文件名后文件保存路径会转移到修改后的路径下面
- 接口类型：HTTP POST
- 消息格式：json
- 请求头：（不懂欸，啥意思）
- 请求字段：

| 字段名   | 字段类型 | 描述                           |
| -------- | :------- | ------------------------------ |
| openid   | String   | 每个微信用户登录小程序独有的id |
| phoneNum | String   | 用户电话号码                   |

- 请求示例：

```json
{
    "id": 1,
    "path": "D:/xxxxxxz/",
    "fileName": "transition1.png",
    "userName": "chenbin"
}
```

- 成功返回字段：

  - code: Integet：删除情况:

    0：文件删除成功，

    -1：文件转移失败，

    -2：源文件不存在，

    -3：删除源文件失败，

    -10：对应id不存在,

    -11：传入参数为空，

     -12 文件夹不存在,

    -13：未传入参数id或则path

- 成功返回示例：

```json
{
    "code": 0
}
```

- 失败返回字段：
- 失败返回示例








#### 4. BimFace文件解析模块

##### 模块描述：

通过配置/resource/bimfaceUser.properties，配置APP_KEY与APP_SECRET，即广联达开发者密码，利用Bimface后端接口，将文件传入开发者文件仓库，再调用接口解析文件，获取文件ViewToken，从而解析文件，前端可以拿到viewToken，完成文件显示

##### 1. HTTP POST /bimFileUpload

- 接口描述：选择待上传的文件，上传到Bimface文件仓库下，返回文件上传结束的fileId

  （加载BimFaceFactory，生成BimFaceClient，利用BimFaceClient的API完成文件上传到Bimface）

- 接口类型：HTTP POST 

- 消息格式：json

- 请求字段：

| 字段名 | 字段类型      | 描述         |
| ------ | :------------ | ------------ |
| file   | MultipartFile | 待上传的文件 |

- 请求示例：

```json
{
    "file": 待上传文件
}
```

- 成功返回字段：
  - fieldId: Long：返回文件上传后的fileId，利用fieldId，转换该文件
- 成功返回示例：

```json
{
    "fieldId": "2a2gsa5s2sa"
}
```

- 失败返回字段：
- 失败返回示例



##### 2. HTTP POST /bimFileTranslate

- 接口描述：传入文件上传结束后的fieldId，转换文件

  （文件转换结束后才能前端解析）

- 接口类型：HTTP POST 

- 消息格式：json

- 请求字段：

| 字段名 | 字段类型 | 描述                    |
| ------ | :------- | ----------------------- |
| fileId | Long     | 文件上传结束后的fieldId |

- 请求示例：

```json
{
    "fieldId": "2a2gsa5s2sa"
}
```

- 成功返回字段：
  - fieldId: Long：返回文件上传后的fileId，利用fieldId，转换该文件
- 成功返回示例：

- 失败返回字段：
- 失败返回示例



##### 3. HTTP GET/view/token/{fileId}

- 接口描述：传入文件上传结束后的fieldId，返回文件viewToken

  （利用文件的viewToken，前端解析）

- 接口类型：HTTP POST 

- 消息格式：json

- 请求字段：

| 字段名 | 字段类型 | 描述                    |
| ------ | :------- | ----------------------- |
| fileId | Long     | 文件上传结束后的fieldId |

- 请求示例：

```json
/view/token/2a2gsa5s2sa
```

- 成功返回字段：
  - viewToken: String：文件解析成功后的viewToken
- 成功返回示例：

```json
{
    "viewToken": "sad14as54a5s5as"
}
```

- 失败返回字段：
- 失败返回示例